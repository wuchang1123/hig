<!DOCTYPE html>  <html> <head>   <title>file.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="brewfile.html">                 brewfile.coffee               </a>                                           <a class="source" href="command.html">                 command.coffee               </a>                                           <a class="source" href="coffee-script.html">                 coffee-script.coffee               </a>                                           <a class="source" href="css.html">                 css.coffee               </a>                                           <a class="source" href="iced-coffee-script.html">                 iced-coffee-script.coffee               </a>                                           <a class="source" href="javascript.html">                 javascript.coffee               </a>                                           <a class="source" href="less.html">                 less.coffee               </a>                                           <a class="source" href="stylus.html">                 stylus.coffee               </a>                                           <a class="source" href="file.html">                 file.coffee               </a>                                           <a class="source" href="index.html">                 index.coffee               </a>                                           <a class="source" href="package.html">                 package.coffee               </a>                                           <a class="source" href="project.html">                 project.coffee               </a>                                           <a class="source" href="source.html">                 source.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               file.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>The <em>File</em> class</h2>

<p>This module exports the <em>File</em> class, which wraps all
information about a file: </p>

<ul>
<li>Its access path and full path</li>
<li>Its type (<em>javascript, css, less, etc.</em>)</li>
<li>Its associated <em><a href="source.html">Source</a></em> and <em><a href="package.html">Package</a></em> objects</li>
</ul>

<p>It also holds all logic related to maintaining and interacting 
with the files on disk.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>First import core modules, as well as third-party modules and
cli utilities.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">path  = </span><span class="nx">require</span> <span class="s1">&#39;path&#39;</span>
<span class="nv">util  = </span><span class="nx">require</span> <span class="s1">&#39;./util&#39;</span>
<span class="nv">fs    = </span><span class="nx">require</span> <span class="s1">&#39;fs&#39;</span>
<span class="p">{</span><span class="nx">EventEmitter</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;events&#39;</span>

<span class="nv">_ = </span><span class="nx">require</span> <span class="s1">&#39;underscore&#39;</span>
<span class="nv">cli = </span><span class="nx">require</span> <span class="s1">&#39;./command&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Initialization</h3>

<p>A <em>File</em> object is initialized with an access path, a type
and a <em>Package</em> object. At this point, it cannot interact with
the filesystem, because it does not know what the fullpath is
(it might not even exist!).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">File</span> <span class="k">extends</span> <span class="nx">EventEmitter</span>
  <span class="nv">constructor: </span><span class="nf">(@relpath, @type, @package) -&gt;</span>
    <span class="vi">@dependencies = </span><span class="p">[]</span>
    <span class="vi">@liabilities = </span><span class="p">[]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>This method associates a file with a fullpath and
a <em>Source</em> object. At this point, it can interact with the
filesystem. It is used first to detect if a file is attached
twice (which shouldn't happen), and to trigger listeners, which
might have been waiting for the file to be attached. This happens
when a file references another one, that does not exist yet.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">attach: </span><span class="nf">(fullpath, source) -&gt;</span>
    <span class="k">if</span> <span class="nx">@attached</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">fullpath</span> <span class="o">isnt</span> <span class="nx">@fullpath</span>
        <span class="nx">cli</span><span class="p">.</span><span class="nx">warning</span> <span class="s1">&#39;with&#39;</span><span class="p">,</span> <span class="nx">fullpath</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        The access path &quot;</span><span class="c1">#{@relpath}&quot; is already associated with &quot;#{@fullpath}&quot;,</span>
        <span class="nx">but</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">file</span> <span class="s2">&quot;#{fullpath}&quot;</span> <span class="o">is</span> <span class="nx">trying</span> <span class="nx">to</span> <span class="nx">get</span> <span class="nx">associated</span> <span class="nx">with</span> <span class="nx">the</span>
        <span class="nx">same</span> <span class="nx">accesspath</span><span class="p">.</span> <span class="nx">Delete</span> <span class="o">or</span> <span class="nx">rename</span> <span class="nx">one</span> <span class="o">or</span> <span class="nx">the</span> <span class="nx">two</span> <span class="nx">to</span> <span class="nx">solve</span> <span class="nx">the</span>
        <span class="nx">problem</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">now</span><span class="p">,</span> <span class="nx">we</span><span class="s1">&#39;re keeping &quot;#{@fullpath}&quot;.</span>
<span class="s1">        &quot;&quot;&quot;</span>
<span class="s1">    else</span>
<span class="s1">      [@fullpath, @source] = [fullpath, source]</span>
<span class="s1">      @emit &#39;</span><span class="nx">attach</span><span class="s1">&#39;</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  register: -&gt;</span>
<span class="s1">    @package.emit &#39;</span><span class="nx">newfile</span><span class="s1">&#39;, this</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  actualize: (cb) -&gt;</span>

<span class="s1">#DIVIDER</span>
<span class="s1">    i = 0</span>
<span class="s1">    iter = () =&gt;</span>
<span class="s1">      if i &lt; @dependencies.length</span>
<span class="s1">        [dep, act] = @dependencies[i++]</span>
<span class="s1">        dep.actualize -&gt; iter()</span>
<span class="s1">      else end()</span>
<span class="s1">    </span>

<span class="s1">#DIVIDER</span>
<span class="s1">    end = () =&gt;</span>
<span class="s1">      if @dependencies.length &gt; 0</span>
<span class="s1">        newest = true</span>
<span class="s1">        for [dep, act] in @dependencies</span>
<span class="s1">          unless @newer dep</span>
<span class="s1">            act dep, this, (err) =&gt;</span>
<span class="s1">              throw new Error err if err</span>
<span class="s1">              cb()</span>
<span class="s1">            </span>
<span class="s1">            newest = false</span>
<span class="s1">            break</span>
<span class="s1">        cb() if newest</span>
<span class="s1">      else cb()</span>
<span class="s1">    </span>
<span class="s1">    iter()</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  project: (dest, morph, cb) -&gt;  </span>
<span class="s1">    @read (err, data) -&gt;</span>
<span class="s1">      cb err if err</span>
<span class="s1">      morph data, (error, newdata) -&gt;</span>
<span class="s1">        dest.write newdata, cb</span>
<span class="s1">      </span>
<span class="s1">    </span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  watch: (reset) -&gt;</span>
<span class="s1">    if @attached() and @liabilities.length &gt; 0</span>
<span class="s1">      </span>

<span class="s1">#DIVIDER</span>
<span class="s1">      return unless !@source? or @source.shouldWatch</span>
<span class="s1">      </span>

<span class="s1">#DIVIDER</span>
<span class="s1">      @stamp()</span>
<span class="s1">      require(&#39;</span><span class="p">.</span><span class="o">/</span><span class="nx">index</span><span class="s1">&#39;).watchers.incr()</span>
<span class="s1">      @watcher = fs.watch @fullpath, (event) =&gt;</span>
<span class="s1">        if event is &#39;</span><span class="nx">rename</span><span class="s1">&#39;</span>
<span class="s1">          cli.info &quot;#{@fullpath} removed&quot;</span>
<span class="s1">          for file in @liabilities</span>
<span class="s1">            file.destroy()</span>
<span class="s1">          </span>
<span class="s1">          setTimeout reset, 50</span>
<span class="s1">        else if @changed()</span>
<span class="s1">          cli.info &quot;#{@fullpath} changed&quot;</span>
<span class="s1">          reset()</span>
<span class="s1">      </span>
<span class="s1">      @watcher.on &#39;</span><span class="nx">error</span><span class="s1">&#39;, (err) =&gt;</span>
<span class="s1">        cli.debug &#39;</span><span class="nx">error</span><span class="s1">&#39;, err</span>
<span class="s1">        reset()</span>
<span class="s1">      </span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  unwatch: -&gt;</span>
<span class="s1">    if @watcher?</span>
<span class="s1">      @watcher.close()</span>
<span class="s1">      require(&#39;</span><span class="p">.</span><span class="o">/</span><span class="nx">index</span><span class="s1">&#39;).watchers.decr()</span>
<span class="s1">      delete @watcher</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  stamp: -&gt; @checksum = util.checksumSync(@fullpath)</span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  changed: -&gt;</span>
<span class="s1">    return true unless (</span>
<span class="s1">      @exists() and @checksum? and</span>
<span class="s1">      @checksum is util.checksumSync(@fullpath)</span>
<span class="s1">    )</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  dependOn: (other, actualize) -&gt;</span>
<span class="s1">    @dependencies.push [other, actualize]</span>
<span class="s1">    other.dependedBy this</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  dependedBy: (other) -&gt;</span>
<span class="s1">    @liabilities.push other</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  readImportedPaths: -&gt;</span>
<span class="s1">    if @source?</span>
<span class="s1">      regexp = @source.constructor.header</span>
<span class="s1">      </span>

<span class="s1">#DIVIDER</span>
<span class="s1">      </span>
<span class="s1">      recurse = (_data) -&gt;</span>
<span class="s1">        return &#39;&#39; unless (match = _data.match regexp)?</span>
<span class="s1">        match[1] + recurse _data[match[0].length+match.index ...]</span>
<span class="s1">      </span>
<span class="s1">      paths = if (json = recurse @readSync()).length &gt; 0</span>
<span class="s1">        JSON.parse json </span>
<span class="s1">      else []</span>
<span class="s1">      paths = (util.changeext(p, &#39;&#39;) for p in paths)</span>
<span class="s1">    else</span>
<span class="s1">      []</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  setImportedPaths: (paths) -&gt; </span>
<span class="s1">    @_importedPaths = paths</span>
<span class="s1">    @_imports = null</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  importedPaths: -&gt;</span>
<span class="s1">    unless @_importedPaths?</span>
<span class="s1">      @_importedPaths = @readImportedPaths()</span>
<span class="s1">    @_importedPaths</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  imports: -&gt;</span>
<span class="s1">    unless @_imports?</span>
<span class="s1">      @_imports = (@package.file(path, @type) for path in @importedPaths())</span>
<span class="s1">    @_imports</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  dependOnImports: (other, actualize) -&gt;</span>
<span class="s1">    imported = []</span>
<span class="s1">    </span>

<span class="s1">#DIVIDER</span>
<span class="s1">    depend = (file) =&gt;                  </span>
<span class="s1">      if file.relpath not in imported</span>
<span class="s1">        if file.attached()</span>
<span class="s1">          crawl file</span>
<span class="s1">        else</span>
<span class="s1">          file.on &#39;</span><span class="nx">attach</span><span class="s1">&#39;, =&gt; crawl file</span>

<span class="s1">        @dependOn file, actualize</span>
<span class="s1">        imported.push file.relpath</span>
<span class="s1">    </span>

<span class="s1">#DIVIDER</span>
<span class="s1">    crawl = (file) -&gt;</span>
<span class="s1">      depend _file for _file in file.imports()</span>
<span class="s1">    </span>

<span class="s1">#DIVIDER</span>
<span class="s1">    depend other</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  tsortedImports: -&gt;</span>
<span class="s1">    topoSortedFiles = []</span>
<span class="s1">    DAG = {}</span>
<span class="s1">    visited = []</span>
<span class="s1">    buildDAG = (file) -&gt;</span>
<span class="s1">      return if file.relpath in visited</span>
<span class="s1">      for n in file.imports()</span>
<span class="s1">        edges = DAG[n.relpath] ?= []</span>
<span class="s1">        edges.push file.relpath</span>
<span class="s1">        buildDAG n</span>
<span class="s1">      visited.push file.relpath</span>
<span class="s1">    </span>
<span class="s1">    buildDAG this</span>
<span class="s1">    S = [this]</span>
<span class="s1">    while S.length &gt; 0</span>
<span class="s1">      n = S.shift()</span>
<span class="s1">      topoSortedFiles.push n</span>
<span class="s1">      for m in n.imports()</span>
<span class="s1">        DAG[m.relpath] = _.without DAG[m.relpath], n.relpath</span>
<span class="s1">        if DAG[m.relpath].length is 0</span>
<span class="s1">          S.push m</span>
<span class="s1">    </span>

<span class="s1">#DIVIDER</span>
<span class="s1">    topoSortedFiles.reverse()</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  newer: (other) -&gt;</span>
<span class="s1">    util.newerSync @fullpath, other.fullpath</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  attached: -&gt; @fullpath?</span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  exists: -&gt; @attached() and path.existsSync @fullpath</span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  makedirs: -&gt; util.makedirs path.dirname @fullpath</span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  read: (cb) -&gt;</span>
<span class="s1">    return unless @exists()</span>
<span class="s1">    fs.readFile @fullpath, &#39;</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="s1">&#39;, (err, data) -&gt; cb(err, data)</span>
<span class="s1">  </span>
<span class="s1">  readSync: -&gt;</span>
<span class="s1">    return unless @exists()</span>
<span class="s1">    fs.readFileSync @fullpath, &#39;</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="s1">&#39;</span>
<span class="s1">  </span>
<span class="s1">  readStream: -&gt;</span>
<span class="s1">    return unless @exists()</span>
<span class="s1">    fs.createReadStream @fullpath, {encoding: &#39;</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="s1">&#39;}</span>
<span class="s1">  </span>
<span class="s1">  </span>

<span class="s1">#DIVIDER</span>
<span class="s1">  write: (data, cb) -&gt;</span>
<span class="s1">    return unless @attached()</span>
<span class="s1">    @makedirs()</span>
<span class="s1">    fs.writeFile @fullpath, data, &#39;</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="s1">&#39;, cb</span>
<span class="s1">  </span>
<span class="s1">  writeSync: (data) -&gt;</span>
<span class="s1">    return unless @attached()</span>
<span class="s1">    @makedirs()</span>
<span class="s1">    fs.writeFileSync @fullpath, data, &#39;</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="s1">&#39;</span>
<span class="s1">  </span>
<span class="s1">  writeStream: -&gt;</span>
<span class="s1">    return unless @attached()</span>
<span class="s1">    @makedirs()</span>
<span class="s1">    fs.createWriteStream @fullpath, {encoding: &#39;</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="err">&#39;</span><span class="p">}</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>This method tells the associated <em>Package</em> object to
register this file, a mechanism required so the package can 
adequately manage all its contained files.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">unlinkSync: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@exists</span><span class="p">()</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">unlinkSync</span> <span class="nx">@fullpath</span>
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>Output methods</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">destroy: </span><span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">file</span> <span class="k">in</span> <span class="nx">@liabilities</span>
      <span class="nx">file</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
    
    <span class="nx">@unlinkSync</span><span class="p">()</span>
  

<span class="nv">exports.File = </span><span class="nx">File</span>

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>This method is used to actualize a file relative to its 
dependencies. It takes a continuation callback as sole argument.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>It first loops through all dependencies, telling each to actualize in 
turn. This is done asynchronously, so we wait for each one to finish before 
continuing to the next. When all are actualized, we call the <code>end()</code> method, 
below. It should be noticed that this is a 
<em><a href="http://en.wikipedia.org/wiki/Depth-first_search">depth-first</a></em>-type 
algorithm.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>When all dependencies are actualized, we, again, loop through all of them
comparing its modification time with this file. In case a given dependency is 
newer, we trigger the associated actualization function, given earlier 
through <code>dependOn(..)</code>. At the end of the loop, if the file is still considered
newest, we trigger the continuation callback, otherwise it will be called at
the end of the actualization.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>This method is used to apply a transformation (<em>morph</em>) to this file 
and output the result in another (<em>dest</em>). It also takes a 
continuation callback as its last argument.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>This method is used to watch the file on the filesystem, which 
should only happend if the file is attached and has liabilities. 
It takes a reset function as sole argument, which is called when 
a change happens.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>If the file has an associated source that should not be 
watched for changes, then the file should not be watched.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>The file is stamped, which means that its md5 checksum is
calculated and cached. Then the FSWatcher is setup to watch
the file. When a 'rename' event happens, the file has either
been removed or moved -- in both cases, this is sufficient
to trigger a reset. If the event is 'change' we make sure
the file has really change by checking the stamp, then trigger
reset in case it really did change.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>This method shuts the watcher if it exists, so no more fs events
are catched. It also decrements the global count of file watchers.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>The stamping method used to cache a md5 checksum of the file on
disk.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>This method returns whether the file on disk should be considered
changed from the last <code>stamp()</code> method call. It returns false if
no checksum is cached.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>Managing <em>dependencies</em></h3>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>This method indicates to the file that it depends on another file.
It takes a file and an actualization function, called when the 
depending file is expired relative to the depended one. Both are 
pushed to a list of dependencies. It also indicates to the other 
file that it is depended upon.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>This method indicates to the file that it is depended by another 
file. This barely adds the file passed as argument to a local list 
of liabilities.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h3>Managing <em>imports</em></h3>

<p>Imports specify what file should precede the current file, should
this file be used in a bundle.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>This method reads the file and parses it to find <code>import</code>
directives. It can only do this if it is attached to a <em>Source</em>
object, since this source specifies the regular expression used
to find those directives.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Every chunk that matches the regexp pattern is concatenated
and the result is assumed to be a JSON array of strings,
and returned.</p>

<p><strong>TODO</strong> : Find something better than this.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>This method is used to specify what the imports of this file
should be. It is used, for instance, to carry over imports that
are specified in a .coffee file, to its output .js file, which
would be used in bundles.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>This returns the list of current imports, as a list of relative
(access) path. It first looks for a cached version, reading it
from the file if not found.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>This returns a list of imports, as a list of <em>File</em> objects. It
first looks for a cached version, making it if not found. It uses
the associated <em>Package</em> object to find those <em>File</em> objects, so
if those files were not initialized, they are still available.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>This method is used to mark the graph of <em>imports</em> (starting at <code>other</code>)
as <em>dependencies</em> on this file. This is used in bundles specifically,
so that changes in any of those imports triggers invalidation of the
bundle.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>The <em>visiting</em> function. It first checks whether a file has already 
been visited, returning if it has. Then it either crawl the file now,
if it is already attached, or as soon as the file is attached. Then,
it marks the visited file as a dependency and pushes it to the list
of visited files.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>The <em>crawling</em> function. It barely calls the visiting function on all
imports of the given file.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>The method starts with the provided file.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h4>Topological sorting algorithm</h4>

<p>This method returns a list of imported files, the order of which 
preserves the precedence specified as 'imports'.</p>

<p>This is used to get one of the solution to
topologically sorting a directed acyclic graph.
It is garanteed to find <em>a</em> solution, given the graph
is really acyclic. Here, nodes are files and edges are
imports expressed within it. This is used to bundle files
in an order that will meet precedence requirements. If cycles
are present, the method will silently fail, yielding a 
non-ordered list.</p>

<p><em>Taken from <a href="http://en.wikipedia.org/wiki/Topological_sort#Algorithms">this page on Wikipedia</a></em></p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>We need it reversed.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <h3>Interacting with the <em>file system</em></h3>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>This method returns whether or not the current file is newer
than the provided one.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>This method returns whether or not the current file is attached,
which barely means, if it has a fullpath.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>This method returns whether or not the current file exists in
the file system.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>This method is used to make sure all directories leading to the
full path exist.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>These methods are used to read the content of the current file.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>These methods are used to write content to the current file.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>This method is used to delete the current file.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>This method is used to delete the current file, as well
as all files that depend on it.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 