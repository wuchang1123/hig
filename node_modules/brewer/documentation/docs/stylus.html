<!DOCTYPE html>  <html> <head>   <title>stylus.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="brewfile.html">                 brewfile.coffee               </a>                                           <a class="source" href="command.html">                 command.coffee               </a>                                           <a class="source" href="coffee-script.html">                 coffee-script.coffee               </a>                                           <a class="source" href="css.html">                 css.coffee               </a>                                           <a class="source" href="iced-coffee-script.html">                 iced-coffee-script.coffee               </a>                                           <a class="source" href="javascript.html">                 javascript.coffee               </a>                                           <a class="source" href="less.html">                 less.coffee               </a>                                           <a class="source" href="stylus.html">                 stylus.coffee               </a>                                           <a class="source" href="file.html">                 file.coffee               </a>                                           <a class="source" href="index.html">                 index.coffee               </a>                                           <a class="source" href="package.html">                 package.coffee               </a>                                           <a class="source" href="project.html">                 project.coffee               </a>                                           <a class="source" href="source.html">                 source.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               stylus.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h3>Stylus extension</h3>

<p>The Stylus extension works by compiling all <em>.styl</em> files
contained in a source of type <em>Stylus</em>, into an output 
directory. That compiled file is marked as impermanent and depends on 
the original <em>.styl</em> file. Imports specified into a <em>.styl</em> file
are carried over to the compiled <em>stylesheet</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_ = </span><span class="nx">require</span> <span class="s1">&#39;underscore&#39;</span>
<span class="p">{</span><span class="nx">Source</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;..&#39;</span>
<span class="p">{</span><span class="nx">finished</span><span class="p">,</span> <span class="nx">debug</span><span class="p">,</span> <span class="nx">error</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;../command&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The <em>Source</em> class is subclassed and essential 
<a href="source.html#section-2">class variables</a> are specified.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">StylusSource</span> <span class="k">extends</span> <span class="nx">Source</span>
  <span class="vi">@type = </span><span class="s1">&#39;stylus&#39;</span>
  <span class="vi">@aliases = </span><span class="p">[</span><span class="s1">&#39;styl&#39;</span><span class="p">]</span>
  <span class="vi">@ext = </span><span class="s1">&#39;.styl&#39;</span>
  <span class="vi">@header = </span><span class="sr">/^\/\/\s*import\s+([a-zA-Z0-9_\-\,\.\[\]\{\}\u0022/ ]+)/m</span>
  <span class="nv">requiredModules: </span><span class="o">-&gt;</span> <span class="p">[</span><span class="s1">&#39;stylus&#39;</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>This method overrides the <code>createFile</code> instance method to create 
a compiled counterpart for every stylus source file found.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">createFile: </span><span class="nf">(path) -&gt;</span>
    <span class="nv">original = </span><span class="k">super</span>
    <span class="nx">@createCompiledFile</span> <span class="nx">original</span>
    <span class="nx">original</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>This method takes a source file as argument and creates another
file that represent the compiled counterpart of the original file.
The fullpath is obtained by concatenating the output directory,
the access path and the '.styl' extension. The new file is marked as
depending on the original stylus source file, carries over
its imports and marked as impermanent.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">createCompiledFile: </span><span class="nf">(original) -&gt;</span>
    <span class="nv">cpath = </span><span class="p">(</span><span class="nx">require</span> <span class="s1">&#39;../util&#39;</span><span class="p">).</span><span class="nx">changeext</span> <span class="p">(</span><span class="nv">opath = </span><span class="nx">original</span><span class="p">.</span><span class="nx">relpath</span><span class="p">),</span> <span class="s1">&#39;.css&#39;</span>
    <span class="nv">compiled = </span><span class="nx">@package</span><span class="p">.</span><span class="nx">file</span> <span class="nx">opath</span><span class="p">,</span> <span class="s1">&#39;stylesheets&#39;</span><span class="p">,</span> 
      <span class="p">(</span><span class="nx">require</span> <span class="s1">&#39;path&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">@output</span><span class="p">,</span> <span class="nx">cpath</span><span class="p">),</span> <span class="err">@</span>
    <span class="nx">compiled</span><span class="p">.</span><span class="nx">dependOn</span> <span class="nx">original</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">@compile</span><span class="p">,</span> <span class="err">@</span><span class="p">)</span>
    <span class="nx">compiled</span><span class="p">.</span><span class="nx">setImportedPaths</span> <span class="nx">original</span><span class="p">.</span><span class="nx">readImportedPaths</span><span class="p">()</span>
    <span class="nv">compiled.impermanent = </span><span class="kc">true</span>
    <span class="nx">compiled</span><span class="p">.</span><span class="nx">register</span><span class="p">()</span>
    <span class="nx">compiled</span>
  </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>This method takes two files and continuation callback, the first
being a stylus source file and the second its compiled 
counterpart. This follows the convention needed by the <code>file.dependOn</code>
method. This method gets called whenever the second file is invalidated
and needs updating.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">compile: </span><span class="nf">(original, compiled, cb) -&gt;</span>
    <span class="nv">compile = </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">cb2</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">parser = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;stylus&#39;</span><span class="p">)</span> <span class="nx">data</span>
      <span class="nx">parser</span><span class="p">.</span><span class="nx">set</span> <span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="nx">@file</span>
      </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The directory of all sources of type stylus are put into a list of paths
so the compiler knows where to look for referenced stylus files. Also,
if a stylus vendor library happens to be a stylus module, we try
to <code>use()</code> it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">parser</span><span class="p">.</span><span class="nx">set</span> <span class="s1">&#39;paths&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">path</span> <span class="k">for</span> <span class="nx">src</span> <span class="k">in</span> <span class="nx">@package</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">stylus</span><span class="p">)</span>
      <span class="k">for</span> <span class="nx">mod</span> <span class="k">in</span> <span class="nx">@package</span><span class="p">.</span><span class="nx">vendorlibs</span><span class="p">.</span><span class="nx">libraries</span> <span class="s1">&#39;stylus&#39;</span>
        <span class="k">try</span>
          <span class="nv">module = </span><span class="nx">require</span> <span class="p">(</span><span class="nx">require</span> <span class="s1">&#39;path&#39;</span><span class="p">).</span><span class="nx">resolve</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">path</span>
          <span class="nx">parser</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">module</span><span class="p">())</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">module</span>
        <span class="k">catch</span> <span class="nx">err</span>
          <span class="k">continue</span>
      
      <span class="nx">parser</span><span class="p">.</span><span class="nx">render</span> <span class="nf">(err, css) -&gt;</span>
        <span class="k">if</span> <span class="nx">err</span><span class="o">?</span>
          <span class="nx">error</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="nx">original</span><span class="p">.</span><span class="nx">fullpath</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span>
          <span class="nx">cb</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nx">cb2</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">css</span>
    </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>It compiles stylus code from the first file and output the result to the 
second file, all of this using the <code>file.project</code> method.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">original</span><span class="p">.</span><span class="nx">project</span> <span class="nx">compiled</span><span class="p">,</span> <span class="nx">compile</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
      <span class="nx">cb</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>
      <span class="nx">finished</span> <span class="s1">&#39;Compiled&#39;</span><span class="p">,</span> <span class="nx">original</span><span class="p">.</span><span class="nx">fullpath</span>
      <span class="nx">cb</span><span class="p">()</span>
    
  

<span class="nx">Source</span><span class="p">.</span><span class="nx">extend</span> <span class="nv">exports.StylusSource = </span><span class="nx">StylusSource</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 