<!DOCTYPE html>  <html> <head>   <title>command.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="brewfile.html">                 brewfile.coffee               </a>                                           <a class="source" href="command.html">                 command.coffee               </a>                                           <a class="source" href="coffee-script.html">                 coffee-script.coffee               </a>                                           <a class="source" href="css.html">                 css.coffee               </a>                                           <a class="source" href="iced-coffee-script.html">                 iced-coffee-script.coffee               </a>                                           <a class="source" href="javascript.html">                 javascript.coffee               </a>                                           <a class="source" href="less.html">                 less.coffee               </a>                                           <a class="source" href="stylus.html">                 stylus.coffee               </a>                                           <a class="source" href="file.html">                 file.coffee               </a>                                           <a class="source" href="index.html">                 index.coffee               </a>                                           <a class="source" href="package.html">                 package.coffee               </a>                                           <a class="source" href="project.html">                 project.coffee               </a>                                           <a class="source" href="source.html">                 source.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               command.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This module holds everything related to interacting with brewer.js from 
the shell, including the <em><a href="#section-6">bin/brewer</a></em> utility, and 
different <a href="#section-5">shell printing functions</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Essential modules are imported</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">fs = </span><span class="nx">require</span> <span class="s1">&#39;fs&#39;</span>
<span class="nv">path = </span><span class="nx">require</span> <span class="s1">&#39;path&#39;</span>
<span class="nv">Command = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;commander&#39;</span><span class="p">).</span><span class="nx">Command</span>
<span class="nv">clr = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ansi-color&#39;</span><span class="p">).</span><span class="nx">set</span>
<span class="nv">_ = </span><span class="nx">require</span> <span class="s1">&#39;underscore&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>This function returns the version number from the <em>package.json</em> file.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.version = getVersion = </span><span class="o">-&gt;</span>
  <span class="nv">fs = </span><span class="nx">require</span> <span class="s1">&#39;fs&#39;</span>
  <span class="nv">path = </span><span class="nx">require</span> <span class="s1">&#39;path&#39;</span>
  <span class="nv">pkg = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../package.json&#39;</span>
  <span class="nx">pkg</span><span class="p">.</span><span class="nx">version</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>This function returns a <code>Project</code> object from the Brewfile located
in the current working directory.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">getLocalProject = </span><span class="o">-&gt;</span>
  <span class="k">new</span> <span class="p">(</span><span class="nx">require</span> <span class="s1">&#39;./index&#39;</span><span class="p">).</span><span class="nx">Project</span> <span class="s1">&#39;./Brewfile&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h4>CLI utility functions</h4>

<p>These functions are used to standardize how certain types of
of messages are displayed in the shell, are all exported and used
throughout brewer.js.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">exports</span><span class="p">,</span> <span class="nv">cli = </span><span class="p">{</span>
  <span class="nv">finished: </span><span class="nf">(action, target) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">clr</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">),</span> <span class="nx">target</span>
  
  <span class="nv">debug: </span><span class="nf">(msgs...) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">clr</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="nx">msgs</span><span class="p">...</span>
  
  <span class="nv">warning: </span><span class="nf">(msgs...) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">clr</span><span class="p">(</span><span class="s1">&#39;Warning&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">),</span> <span class="nx">msgs</span><span class="p">...</span>
  
  <span class="nv">info: </span><span class="nf">(msgs...) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">clr</span><span class="p">(</span><span class="s1">&#39;Info&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">),</span> <span class="nx">msgs</span><span class="p">...</span>
  
  <span class="nv">error: </span><span class="nf">(msgs...) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">clr</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="nx">msgs</span><span class="p">...</span>
  
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>bin/brewer</h3>

<p>Making heavy use of 
<a href="http://visionmedia.github.com/commander.js/">commander.js</a>.
A <code>run</code> function is exported, which takes the process argument list (<code>process.argv</code>)
as arguments and executes a <em>Commander.js</em>'s Command object on them. The version is
extracted using <a href="#section-3"><code>getVersion()</code></a> above.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.run = </span><span class="nf">(argv) -&gt;</span>
  <span class="p">(</span><span class="nv">program = </span><span class="k">new</span> <span class="nx">Command</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">version</span><span class="p">(</span><span class="nx">getVersion</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;-t, --template &lt;template&gt;&#39;</span><span class="p">,</span> 
      <span class="s1">&#39;Specify the project template to use (default to \&#39;lesscoffee\&#39;) when initializing.&#39;</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h4>The <code>init</code> command</h4>

<p>This command is used to initialize a Brewfile and a directory structure in the
current working directory. It first checks if a template was specified, using the 
default otherwise. It writes that template file into <em>Brewfile</em>, initialize a
<code>Project</code> object from it and asks it to produce the directory structure.</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nx">program</span>
    <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="s2">&quot; Initialize #{clr(&#39;Brewer&#39;, &#39;green&#39;)} in the current directory&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">action</span> <span class="o">-&gt;</span>
      <span class="nv">templ = </span><span class="nx">program</span><span class="p">.</span><span class="nx">template</span> <span class="o">?</span> <span class="s1">&#39;lesscoffee&#39;</span>
      <span class="nv">template = </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">,</span> <span class="s2">&quot;#{templ}.coffee&quot;</span><span class="p">)</span>
      <span class="nv">content = </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span> <span class="nx">template</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span>
      <span class="nx">cli</span><span class="p">.</span><span class="nx">info</span> <span class="s1">&#39;Writing Brewfile&#39;</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span> <span class="s1">&#39;Brewfile&#39;</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span>
      
      <span class="nx">cli</span><span class="p">.</span><span class="nx">info</span> <span class="s1">&#39;Making initial folder structure&#39;</span>
      <span class="nx">getLocalProject</span><span class="p">().</span><span class="nx">prepare</span><span class="p">()</span>
    
  </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h4>The <code>watch</code> command</h4>

<p>This command is used to watch a whole project, monitoring changes on the
<em>Brewfile</em>, as well as changed, new, deleted or moved source files. When such 
changes occus, the local <code>Project</code> object is asked to re-actualize.
All the logic is contained in the <code>Project</code> class, so here only the <code>.watch()</code>
method is called.</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nx">program</span>
    <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;watch&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">       Watch for modifications in source and configuration files, </span>
<span class="s2">      automatically re-making when they occur.</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">action</span> <span class="o">-&gt;</span>
      <span class="nx">getLocalProject</span><span class="p">().</span><span class="nx">watch</span><span class="p">()</span>
      <span class="nx">cli</span><span class="p">.</span><span class="nx">info</span> <span class="s1">&#39;Watching project&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">()</span>
    
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h4>The <code>clean</code> command</h4>

<p>This command is used to remove files that are derived from source files. This 
includes compiled <em>javascript</em> and <em>css</em> files, as well as bundles and their
compressed counterparts.</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nx">program</span>
    <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;clean [packages]*&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="s2">&quot; Delete bundles and compiled files from the given packages (or all)&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">action</span> <span class="nf">(pkgs) -&gt;</span>
      <span class="nx">pkgs</span> <span class="o">?=</span> <span class="s1">&#39;all&#39;</span>
      <span class="nv">project = </span><span class="nx">getLocalProject</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">pkgs</span> <span class="o">is</span> <span class="s1">&#39;all&#39;</span>
        <span class="nv">packages = </span><span class="nx">project</span>
      <span class="k">else</span>
        <span class="nv">names = </span><span class="nx">pkgs</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="nv">packages = </span><span class="p">(</span><span class="nx">pkg</span> <span class="k">for</span> <span class="nx">pkg</span> <span class="k">in</span> <span class="nx">project</span> <span class="k">when</span> <span class="nx">pkg</span><span class="p">.</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">names</span><span class="p">)</span>
      
      <span class="k">for</span> <span class="nx">pkg</span> <span class="k">in</span> <span class="nx">packages</span>
        <span class="nx">do</span> <span class="nf">(pkg) -&gt;</span> <span class="nx">pkg</span><span class="p">.</span><span class="nx">clean</span><span class="p">()</span>
    
  </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h4>The <code>install</code> command</h4>

<p>This command is used to install the modules required for the current project 
to function properly, according to the Brewfile.</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nx">program</span>
    <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="s2">&quot; Install missing modules required to manage the current project&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">action</span> <span class="o">-&gt;</span>
      <span class="nv">project = </span><span class="nx">getLocalProject</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">project</span><span class="p">.</span><span class="nx">missingModules</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nx">project</span><span class="p">.</span><span class="nx">installMissingModules</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">cli</span><span class="p">.</span><span class="nx">info</span> <span class="s1">&#39;No modules are missing.&#39;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h4>The main <code>brake</code> command</h4>

<p>This command is used to actualize a whole project or specific packages within it.
It first checks to see if package names were specified, or <code>all</code>, which means "all packages".
Then, the <code>.actualize()</code> method is called on each matching package.</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nx">program</span>
    <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="s2">&quot; Aggregate bundles from the given packages (or all)&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">action</span> <span class="nf">(pkgs...) -&gt;</span>
      <span class="nx">pkgs</span> <span class="o">?=</span> <span class="s1">&#39;all&#39;</span>
      <span class="nv">project = </span><span class="nx">getLocalProject</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">pkgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="s1">&#39;all&#39;</span>
        <span class="nv">packages = </span><span class="nx">project</span>
      <span class="k">else</span>
        <span class="nv">packages = </span><span class="p">(</span><span class="nx">pkg</span> <span class="k">for</span> <span class="nx">pkg</span> <span class="k">in</span> <span class="nx">project</span> <span class="k">when</span> <span class="nx">pkg</span><span class="p">.</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">pkgs</span><span class="p">)</span>
      
      <span class="k">for</span> <span class="nx">pkg</span> <span class="k">in</span> <span class="nx">packages</span>
        <span class="nx">do</span> <span class="nf">(pkg) -&gt;</span>
          <span class="nx">pkg</span><span class="p">.</span><span class="nx">actualize</span> <span class="o">-&gt;</span>
            <span class="nx">cli</span><span class="p">.</span><span class="nx">info</span> <span class="s2">&quot;Finished making #{clr(pkg.name, &#39;underline&#39;)} package&quot;</span>
    
  </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>This tells the <code>Command</code> object to parse the given program arguments, triggering
the proper action, or printing the usage.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">program</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">argv</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 