<!DOCTYPE html>  <html> <head>   <title>brewfile.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="brewfile.html">                 brewfile.coffee               </a>                                           <a class="source" href="command.html">                 command.coffee               </a>                                           <a class="source" href="coffee-script.html">                 coffee-script.coffee               </a>                                           <a class="source" href="css.html">                 css.coffee               </a>                                           <a class="source" href="iced-coffee-script.html">                 iced-coffee-script.coffee               </a>                                           <a class="source" href="javascript.html">                 javascript.coffee               </a>                                           <a class="source" href="less.html">                 less.coffee               </a>                                           <a class="source" href="stylus.html">                 stylus.coffee               </a>                                           <a class="source" href="file.html">                 file.coffee               </a>                                           <a class="source" href="index.html">                 index.coffee               </a>                                           <a class="source" href="package.html">                 package.coffee               </a>                                           <a class="source" href="project.html">                 project.coffee               </a>                                           <a class="source" href="source.html">                 source.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               brewfile.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This module is used internally to parse a Brewfile at the
root folder of a given project. It exports a single function :</p>

<ul>
<li><p><code>configs(file)</code></p>

<p>This function takes the path to a Brewfile and returns a
configuration object that can be used to initialize a 
<code>Project</code> object.</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Some essential core modules are loaded, as well as coffee-script
since a brewfile is written using this language.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_ = </span><span class="nx">require</span> <span class="s1">&#39;underscore&#39;</span>
<span class="nv">vm = </span><span class="nx">require</span> <span class="s1">&#39;vm&#39;</span>
<span class="nv">fs = </span><span class="nx">require</span> <span class="s1">&#39;fs&#39;</span>
<span class="nv">coffeescript = </span><span class="nx">require</span> <span class="s1">&#39;coffee-script&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Brewer classes (and utilities) are imported</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">{</span><span class="nx">debug</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;./command&#39;</span>
<span class="nv">brewer = </span><span class="nx">require</span> <span class="s1">&#39;./index&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>Source directives</h3>

<p>This is the prototype of a Source configuration object.
The functions defined here are available in the
function body provided at the end of a <code>@source</code> statement</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Source =</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>The method used to specify options on a source 
configuration object</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">options: </span><span class="nf">(opts) -&gt;</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">@opts</span><span class="p">,</span> <span class="nx">opts</span>
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>Package directives</h3>

<p>This is the prototype of a Package configuration object.
The functions defined here are available in the
function body provided at the end of a package statement
such as <code>@javascript</code> or <code>@stylesheets</code>, and operate on
a package configuration object, used later as the first
argument when initializing a <em><a href="package.html">Package</a></em> object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Package =</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>A method used to specify options on a package 
configuration object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">options: </span><span class="nf">(opts) -&gt;</span> 
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">@opts</span><span class="p">,</span> <span class="nx">opts</span>
  </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>A method used to define bundles within a package</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">bundles: </span><span class="nf">(bundles...) -&gt;</span>
    <span class="nx">@opts</span><span class="p">.</span><span class="nx">bundles</span> <span class="o">?=</span> <span class="p">[]</span>
    <span class="vi">@opts.bundles = </span><span class="nx">_</span><span class="p">.</span><span class="nx">union</span> <span class="nx">@opts</span><span class="p">.</span><span class="nx">bundles</span><span class="p">,</span> <span class="nx">bundles</span>
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>A method used to define a source in a package.
The type of the source here is inferred by the
default source type of the parent package</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">source: </span><span class="nf">(path, opts, cb) -&gt;</span>
    <span class="nx">@_source</span><span class="p">.</span><span class="nx">call</span> <span class="k">this</span><span class="p">,</span> <span class="nx">@opts</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">cb</span>
  </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>A common method used to define any type of 
source in a package.
A source configuration object is initialized
with the Source prototype above.
The options object is initialized then
put in the source object. We add the source 
config object to parent package, then call the trailing 
function, if present with <code>this</code> set to the source object</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_source: </span><span class="nf">(type, path, opts, cb) -&gt;</span>
    <span class="nv">src = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="nx">Source</span>
    
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">opts</span>
      <span class="nv">cb = </span><span class="nx">opts</span>
      <span class="nv">opts = </span><span class="p">{}</span>
    
    <span class="nx">opts</span> <span class="o">?=</span> <span class="p">{}</span>
    <span class="nx">opts</span><span class="p">.</span><span class="nx">type</span> <span class="o">?=</span> <span class="nx">type</span>
    <span class="nv">opts.path = </span><span class="nx">path</span>
    <span class="nv">src.opts = </span><span class="nx">opts</span>
    <span class="nx">@srcs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">src</span><span class="p">.</span><span class="nx">opts</span>
    
    <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span> <span class="nx">src</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">cb</span>
  </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Iterate through all defined source types to add their
type names to the Package object prototype, to add them as
proxies to the Package._source method</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">brewer</span><span class="p">.</span><span class="nx">Source</span><span class="p">.</span><span class="nx">types</span><span class="p">(),</span> <span class="nf">(key) -&gt;</span>
  <span class="nx">Package</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nf">(path, options, cb) -&gt;</span>
    <span class="nx">Package</span><span class="p">.</span><span class="nx">_source</span><span class="p">.</span><span class="nx">call</span> <span class="k">this</span><span class="p">,</span> <span class="nx">brewer</span><span class="p">.</span><span class="nx">Source</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">type</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span>
  </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>The function used to define a package object in a Brewfile.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">package = </span><span class="nf">(type, name, opts, cb) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>A package config object is initialized with the
Package prototype above, then added to the list of 
packages for the Brewfile.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pkg = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="nx">Package</span>
  <span class="nx">@packages</span><span class="p">.</span><span class="nx">push</span> <span class="nx">pkg</span>
  </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>The package options are set using the provided values</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">opts</span>
    <span class="nv">cb = </span><span class="nx">opts</span>
    <span class="nv">opts = </span><span class="p">{}</span>
  
  <span class="nx">opts</span><span class="p">.</span><span class="nx">type</span> <span class="o">?=</span> <span class="nx">type</span>
  <span class="nv">opts.name = </span><span class="nx">name</span>
  <span class="nv">pkg.opts = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">opts</span>
  <span class="nv">pkg.srcs = </span><span class="p">[]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Then the trailing function is called with <code>this</code> set
as the new package object</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span> <span class="nx">pkg</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">cb</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>A utility function used to initialize a V8 Context
to encapsulate the configuration included in the
Brewfile and all the DSL functions.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">newContext = </span><span class="nf">() -&gt;</span>
  <span class="nv">ctx = </span><span class="p">{</span>
    <span class="nv">project: prj = </span><span class="p">{</span>
      <span class="nv">root: </span><span class="s1">&#39;.&#39;</span>
      <span class="nv">packages: </span><span class="p">[]</span>
      <span class="nv">reqs: </span><span class="p">{}</span>
      <span class="nv">vendorDir: </span><span class="s1">&#39;./vendor&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Iterate through all package types, using their
type name to proxy the <code>package</code> definition function
above.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">brewer</span><span class="p">.</span><span class="nx">Package</span><span class="p">.</span><span class="nx">types</span><span class="p">(),</span> <span class="nf">(key) -&gt;</span>
    <span class="nx">ctx</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nf">(name, opts, cb) -&gt;</span>
      <span class="nx">package</span><span class="p">.</span><span class="nx">call</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">project</span><span class="p">,</span> <span class="nx">brewer</span><span class="p">.</span><span class="nx">Package</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">type</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">cb</span>
    </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Define DSL functions to specify properties of the project</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ctx.root = </span><span class="nf">(newRoot) -&gt;</span> <span class="nv">prj.root = </span><span class="nx">newRoot</span>
  <span class="nv">ctx.vendor = </span><span class="nf">(newVendorDir) -&gt;</span> <span class="nv">prj.vendorDir = </span><span class="nx">newVendorDir</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Define the DSL <code>require</code> function that adds libraries to be the
included in the project. This function can be called any number
of times in a Brewfile. All dependencies are stored in an object
in the form of <code>&lt;library name&gt;: &lt;semantic version&gt;</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ctx.require = </span><span class="nf">(reqs) -&gt;</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">reqs</span>
      <span class="k">for</span> <span class="nx">req</span> <span class="k">in</span> <span class="nx">reqs</span> <span class="k">when</span> <span class="nx">req</span> <span class="o">not</span> <span class="k">of</span> <span class="nx">prj</span><span class="p">.</span><span class="nx">reqs</span>
        <span class="nx">prj</span><span class="p">.</span><span class="nx">reqs</span><span class="p">[</span><span class="nx">lib</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;latest&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">reqs</span>
      <span class="k">if</span> <span class="nx">reqs</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">prj</span><span class="p">.</span><span class="nx">reqs</span>
        <span class="nx">prj</span><span class="p">.</span><span class="nx">reqs</span><span class="p">[</span><span class="nx">reqs</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;latest&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">reqs</span>
      <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">reqs</span>
        <span class="nx">prj</span><span class="p">.</span><span class="nx">reqs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Return a V8 context, using the container above as
a seed.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">vm</span><span class="p">.</span><span class="nx">createContext</span> <span class="nx">ctx</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>This is the exported function, which takes a path to a Brewfile 
as argument and returns a configuration object containing all the 
packages. It uses Coffee-script's <code>eval</code> function to execute the file 
content, using the <code>newContext</code> function above to get a context 
appropriate for the DSL, and setting the filename to ease debugging.
Once the file was executed, <code>ctx.project</code> 
holds the set of configurations for a project object, which is returned.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="vi">@configs = </span><span class="nv">configs = </span><span class="nf">(file) -&gt;</span>
  <span class="nx">coffeescript</span><span class="p">.</span><span class="nb">eval</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> 
    <span class="nv">sandbox: ctx = </span><span class="nx">newContext</span><span class="p">()</span>
    <span class="nv">filename: </span><span class="nx">file</span>
  
  <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">project</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 